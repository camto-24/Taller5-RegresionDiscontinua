# Quitar comentarios de stargazer (para un .tex limpio)
tabla_cluster <- tabla_cluster[!grepl("^%", tabla_cluster)]
# Guardar en archivo .tex
writeLines(tabla_cluster, "Tablas/modelos_globo_genero.tex")
# Mostrar tabla en consola (opcional)
cat(tabla_cluster, sep = "\n")
# Filtrar la submuestra dentro del rango -0.12 a 0.12
turquia_sub_h2 <- subset(turquia, X >= -0.12 & X <= 0.12)
# Modelo Mujeres
modelo_f_h2 <- feols(
hischshr1520f ~ i98 + X + X_m +
vshr_islam1994 + partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_sub_h2,
cluster = ~prov_num
)
# Modelo Hombres
modelo_m_h2 <- feols(
hischshr1520m ~ i98 + X + X_m +
vshr_islam1994 + partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_sub_h2,
cluster = ~prov_num
)
# Exportar tabla a LaTeX
etable(
modelo_f_h2, modelo_m_h2,
se = "cluster",
cluster = ~prov_num,
tex = TRUE,  # Genera LaTeX
file = "Tablas/modelos_globo_genero_sub_h2.tex",
title = "Impacto de Globo sobre escolarización por género (submuestra X ∈ [-0.12, 0.12])",
dict = c(
hischshr1520f = "Escolarización femenina",
hischshr1520m = "Escolarización masculina",
i98 = "Cobertura Globo (i98)"
),
keep = c("i98", "X", "X_m", "vshr_islam1994", "partycount", "lpop1994",
"ageshr19", "ageshr60", "sexr", "shhs", "merkezi", "merkezp",
"subbuyuk", "buyuk")
)
View(turquia)
# Renombrar margen electoral
turquia <- turquia %>%
rename(xi = ilmvsm1994) %>%       # renombrar variable
mutate(
di = ifelse(xi >= 0, 1, 0),    # tratamiento: alcalde islámico
hischshr1520m = hischshr1520m / 100,  # pasar a proporción
hischshr1520f = hischshr1520f / 100
)
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
knitr::opts_knit$set(root.dir = "C:/1. MECA/2025/EVALUACIACÓN DE IMPACTO- Raachid Raaj/Taller5-RegresionDiscontinua")
tinytex::tlmgr_update(self = TRUE, all = TRUE)
if (!requireNamespace("tinytex", quietly = TRUE)) {
install.packages("tinytex")
}
# Verificar si TinyTeX está instalado
if (tinytex::is_tinytex()) {
message("TinyTeX detectado. Actualizando instalación...")
# Actualizar gestor de paquetes (self) y todos los paquetes
tinytex::tlmgr_update(self = TRUE, all = TRUE)
message("✅ TinyTeX actualizado correctamente.")
} else {
message("No se detecta TinyTeX. Si usas MikTeX o TeX Live, actualiza manualmente.")
}
# Cargar liberias y paquetes
# Instalando pacman si se requiere
if (!require("pacman")) install.packages("pacman")
# Cargando los paquetes usando pacman
pacman::p_load(
# A) Manipulación, limpieza y visualización de datos
tidyverse,    # Colección de paquetes esenciales (incluye dplyr, ggplot2, etc.)
dplyr,        # Manipulación de datos (ya incluido en tidyverse, pero lo dejamos explícito).
ggplot2,      # Visualización de datos (incluido en tidyverse).
scales,       # Manejo de escalas (ej. porcentajes, comas).
skimr,        # Resúmenes estadísticos rápidos de data.frames.
# B) Modelado y análisis estadístico/econométrico
fixest,       # Modelos de efectos fijos de alto rendimiento.
plm,          # Modelos para datos de panel.
AER,          # Herramientas de econometría aplicada.
lmtest,       # Pruebas de hipótesis para modelos de regresión.
sandwich,     # Errores estándar robustos.
survey,       # Análisis de encuestas complejas.
# C) Importación, exportación y generación de reportes
haven,        # Lectura/escritura de Stata, SAS, SPSS.
stargazer,    # Tablas de regresión con formato publicable.
knitr,        # Reportes dinámicos en RMarkdown.
modelsummary, # Tablas y resúmenes comparativos de modelos.
tinytex       # Soporte para compilar a PDF con LaTeX en RMarkdown.
)
library(lfe)
# Definir carpeta de datos (ruta relativa)
path <- file.path(getwd(), "Datos/turquia.dta")
data <- read_dta(path)
# Fijar semilla con el cod de Laura
set.seed(202421904)
# Eliminar aletoriamente el 5% de las obs
n_eliminar <- round(0.05 * nrow(data))
filas_eliminar <- sample(1:nrow(data), n_eliminar)
turquia <- data[-filas_eliminar, ]
# Renombrar margen electoral
turquia <- turquia %>%
rename(xi = ilmvsm1994) %>%       # renombrar variable
mutate(
di = ifelse(xi >= 0, 1, 0),    # tratamiento: alcalde islámico
hischshr1520m = hischshr1520m / 100,  # pasar a proporción
hischshr1520f = hischshr1520f / 100
)
View(turquia)
# Primer modelo sin controles para ambos sexos
modelo_f <- lm(hischshr1520f ~ mi + xi, data = turquia)  # mujeres
# Tratamiento
turquia <- turquia %>%
rename(xi = ilmvsm1994) %>%       # renombrar variable
mutate(
di = ifelse(xi >= 0, 1, 0),    # tratamiento: alcalde islámico
hischshr1520m = hischshr1520m / 100,  # pasar a proporción
hischshr1520f = hischshr1520f / 100
)
# Primer modelo sin controles para ambos sexos
modelo_f <- lm(hischshr1520f ~ di + xi, data = turquia)  # mujeres
modelo_m <- lm(hischshr1520m ~ di + xi, data = turquia)  # hombres
# Errores estándar agrupados por provincia
se_f <- sqrt(diag(vcovCL(modelo_f, cluster = ~ prov_num)))
se_m <- sqrt(diag(vcovCL(modelo_m, cluster = ~ prov_num)))
# Tabla
stargazer(modelo_f, modelo_m,
type = "latex",   # usa formato LaTeX para PDF
se = list(se_f, se_m),
title = "Regresión Discontinua: efecto de alcaldes islámicos sobre educación secundaria",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
covariate.labels = c("Alcalde islámico (m_i)", "Margen de victoria (x_i)"),
notes = "Errores estándar agrupados por provincia.",
digits = 3)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla_cluster <- tabla_cluster[!grepl("^%", tabla_cluster)]
# Primer modelo sin controles para ambos sexos
modelo_f <- lm(hischshr1520f ~ di + xi, data = turquia)  # mujeres
modelo_m <- lm(hischshr1520m ~ di + xi, data = turquia)  # hombres
# Errores estándar agrupados por provincia
se_f <- sqrt(diag(vcovCL(modelo_f, cluster = ~ prov_num)))
se_m <- sqrt(diag(vcovCL(modelo_m, cluster = ~ prov_num)))
# Tabla en Latex para Pdf
tabla1 <- capture.output(
stargazer(
modelo_f, modelo_m,
type = "latex",
se = list(se_f, se_m),
title = "Regresión Discontinua: efecto de alcaldes islámicos sobre educación secundaria",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
covariate.labels = c("Alcalde islámico (Dᵢ)", "Margen de victoria (Xᵢ)"),
notes = "Errores estándar agrupados por provincia.",
digits = 3,
label = "tab:rd_mujeres_hombres",
header = FALSE,  # evita preámbulo LaTeX
table.placement = "ht!"
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla1 <- tabla1[!grepl("^%", tabla1)]
# --- Guardar .tex limpio ---
writeLines(tabla1, "Tablas/tabla1.tex")
# Mostrar tabla en consola (opcional)
cat(tabla1, sep = "\n")
# Mostrar tabla en consola (opcional)
cat(tabla1, sep = "\n")
stargazer(modelo_f, modelo_m,
type = "text",
se = list(se_f, se_m),
title = "Regresión Discontinua: efecto de alcaldes islámicos sobre educación secundaria",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
covariate.labels = c("Alcalde islámico (Dᵢ)", "Margen de victoria (Xᵢ)"),
notes = "Errores estándar agrupados por provincia.",
digits = 3)
# Con controles y polinomio lineal
# Mujeres
modelo_f2 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia)
# Hombres
modelo_m2 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia)
# Errores clusterizados
se_f_2 <- sqrt(diag(vcovCL(modelo_f2, cluster = ~prov_num)))
se_m_2 <- sqrt(diag(vcovCL(modelo_m2, cluster = ~prov_num)))
# Tabla en Latex para Pdf
tabla2 <- capture.output(
stargazer(modelo_f_lm, modelo_m_lm, se = list(se_f, se_m),
type = "latex",
dep.var.labels = c("Escolarización femenina", "Escolarización masculina"),
column.labels = c("Mujeres", "Hombres"),
covariate.labels = c(
"Cobertura Globo (i98)",
"X",
"X_m",
"Islam 1994",
"Número de partidos",
"Población 1994",
"Edad 19",
"Edad 60",
"Sexo",
"Shhs",
"Merkezi",
"Merkezp",
"Subbuyuk",
"Buyuk"
),
title = "Impacto de Globo sobre escolarización por género",
label = "tab:globo_genero",
digits = 3,
notes = "Errores estándar agrupados por provincia.")
)
# Con controles y polinomio lineal
# Mujeres
modelo_f2 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia)
# Hombres
modelo_m2 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia)
# Errores clusterizados
se_f_2 <- sqrt(diag(vcovCL(modelo_f2, cluster = ~prov_num)))
se_m_2 <- sqrt(diag(vcovCL(modelo_m2, cluster = ~prov_num)))
# Tabla en Latex para Pdf
tabla2 <- capture.output(
stargazer(modelo_f2, modelo_m2, se = list(se_f_2, se_m_2),
type = "latex",
dep.var.labels = c("Escolarización femenina", "Escolarización masculina"),
column.labels = c("Mujeres", "Hombres"),
covariate.labels = c(
"Cobertura Globo (i98)",
"X",
"X_m",
"Islam 1994",
"Número de partidos",
"Población 1994",
"Edad 19",
"Edad 60",
"Sexo",
"Shhs",
"Merkezi",
"Merkezp",
"Subbuyuk",
"Buyuk"
),
title = "Impacto de Globo sobre escolarización por género",
label = "tab:globo_genero",
digits = 3,
notes = "Errores estándar agrupados por provincia.")
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla2 <- tabla2[!grepl("^%", tabla2)]
# --- Guardar .tex limpio ---
writeLines(tabla2, "Tablas/tabla1.tex")
# Mostrar tabla en consola (opcional)
cat(tabla2, sep = "\n")
tabla2
# Con controles y polinomio lineal
# Mujeres
modelo_f2 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia)
# Hombres
modelo_m2 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia)
# Errores clusterizados
se_f_2 <- sqrt(diag(vcovCL(modelo_f2, cluster = ~prov_num)))
se_m_2 <- sqrt(diag(vcovCL(modelo_m2, cluster = ~prov_num)))
# Tabla en Latex para Pdf
tabla2 <- capture.output(
stargazer(modelo_f2, modelo_m2, se = list(se_f_2, se_m_2),
type = "latex",
dep.var.labels = c("Escolarización femenina", "Escolarización masculina"),
column.labels = c("Mujeres", "Hombres"),
covariate.labels = c(
"Cobertura Globo (i98)",
"X",
"X_m",
"Islam 1994",
"Número de partidos",
"Población 1994",
"Edad 19",
"Edad 60",
"Sexo",
"Shhs",
"Merkezi",
"Merkezp",
"Subbuyuk",
"Buyuk"
),
title = "Impacto de Globo sobre escolarización por género",
label = "tab:globo_genero",
digits = 3,
notes = "Errores estándar agrupados por provincia.")
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla2 <- tabla2[!grepl("^%", tabla2)]
# --- Guardar .tex limpio ---
writeLines(tabla2, "Tablas/tabla1.tex")
# Mostrar tabla en consola (opcional)
cat(tabla2, sep = "\n")
stargazer(modelo_f2, modelo_m2, se = list(se_f_2, se_m_2),
type = "text",
dep.var.labels = c("Escolarización femenina", "Escolarización masculina"),
column.labels = c("Mujeres", "Hombres"),
covariate.labels = c(
"Cobertura Globo (i98)", "X", "X_m", "Islam 1994", "Número de partidos",
"Población 1994", "Edad 19", "Edad 60", "Sexo", "Shhs",
"Merkezi", "Merkezp", "Subbuyuk", "Buyuk"
),
title = "Impacto de Globo sobre escolarización por género",
label = "tab:globo_genero",
digits = 3,
notes = "Errores estándar agrupados por provincia.")
# Filtrar submuestra
turquia_sub <- subset(turquia, X >= -0.24 & X <= 0.24)
# Filtrar submuestra
turquia_sub <- subset(turquia, xi >= -0.24 & xi <= 0.24)
# Modelos en la submuestra
modelo_f_sub <- feols(
hischshr1520f ~ i98 + X + X_m +
vshr_islam1994 + partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_sub,
cluster = ~prov_num
)
# Filtrar submuestra
turquia_sub <- subset(turquia, xi >= -0.24 & xi <= 0.24)
# Mujeres
modelo_f_h <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_h)
# Filtrar submuestra
turquia_sub <- subset(turquia, xi >= -0.24 & xi <= 0.24)
# Mujeres
modelo_f3 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_sub)
# Hombres
modelo_m3 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_sub)
# Errores clusterizados
se_f3 <- sqrt(diag(vcovCL(modelo_f3, cluster = ~prov_num)))
se_m3 <- sqrt(diag(vcovCL(modelo_m3, cluster = ~prov_num)))
# Filtrar la submuestra dentro del rango -0.12 a 0.12
turquia_sub_h2 <- subset(turquia, xi >= -0.12 & xi <= 0.12)
# Mujeres
modelo_f4 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_h2)
# Filtrar la submuestra dentro del rango -0.12 a 0.12
turquia_sub_h2 <- subset(turquia, xi >= -0.12 & xi <= 0.12)
# Mujeres
modelo_f4 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_sub_h2)
# Hombres
modelo_m4 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk +
factor(prov_num),
data = turquia_sub_h2)
# Errores clusterizados
se_f4 <- sqrt(diag(vcovCL(modelo_f4, cluster = ~prov_num)))
se_m4 <- sqrt(diag(vcovCL(modelo_m4, cluster = ~prov_num)))
library(stargazer)
stargazer(modelo_f_noctrl, modelo_f_ctrl, modelo_f_h, modelo_f_h2,
se = list(se_f_noctrl, se_f_ctrl, se_f_h, se_f_h2),
type = "text",
dep.var.labels = "Escolarización femenina",
column.labels = c("Sin controles", "Controles", "Controles h_hat", "Controles h_hat/2"),
covariate.labels = c("Alcalde islámico", "xi", "xi*di",
"Número de partidos", "Población 1994",
"Edad 19", "Edad 60", "Sexo", "Shhs",
"Merkezi", "Merkezp", "Subbuyuk", "Buyuk"),
digits = 3,
title = "Resultados por género: Mujeres")
knitr::opts_knit$set(root.dir = "C:/Users/mc-c2/OneDrive - Universidad de los andes/Universidad/MECA/Big Data y Machine Learning/Repositorios/BD_ML_taller_1/Taller5-RegresionDiscontinua")
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
tinytex::tlmgr_update(self = TRUE, all = TRUE)
tinytex::tlmgr_update(self = TRUE, all = TRUE)
if (!requireNamespace("tinytex", quietly = TRUE)) {
install.packages("tinytex")
}
# Verificar si TinyTeX está instalado
if (tinytex::is_tinytex()) {
message("TinyTeX detectado. Actualizando instalación...")
# Actualizar gestor de paquetes (self) y todos los paquetes
tinytex::tlmgr_update(self = TRUE, all = TRUE)
message("✅ TinyTeX actualizado correctamente.")
} else {
message("No se detecta TinyTeX. Si usas MikTeX o TeX Live, actualiza manualmente.")
}
# Cargar liberias y paquetes
# Instalando pacman si se requiere
if (!require("pacman")) install.packages("pacman")
# Cargando los paquetes usando pacman
pacman::p_load(
# A) Manipulación, limpieza y visualización de datos
tidyverse,    # Colección de paquetes esenciales (incluye dplyr, ggplot2, etc.)
dplyr,        # Manipulación de datos (ya incluido en tidyverse, pero lo dejamos explícito).
ggplot2,      # Visualización de datos (incluido en tidyverse).
scales,       # Manejo de escalas (ej. porcentajes, comas).
skimr,        # Resúmenes estadísticos rápidos de data.frames.
# B) Modelado y análisis estadístico/econométrico
fixest,       # Modelos de efectos fijos de alto rendimiento.
plm,          # Modelos para datos de panel.
AER,          # Herramientas de econometría aplicada.
lmtest,       # Pruebas de hipótesis para modelos de regresión.
sandwich,     # Errores estándar robustos.
survey,       # Análisis de encuestas complejas.
# C) Importación, exportación y generación de reportes
haven,        # Lectura/escritura de Stata, SAS, SPSS.
stargazer,    # Tablas de regresión con formato publicable.
knitr,        # Reportes dinámicos en RMarkdown.
modelsummary, # Tablas y resúmenes comparativos de modelos.
tinytex       # Soporte para compilar a PDF con LaTeX en RMarkdown.
)
library(lfe)
# Definir carpeta de datos (ruta relativa)
path <- file.path(getwd(), "Datos/turquia.dta")
data <- read_dta(path)
knitr::opts_knit$set(root.dir = "C:/Users/mc-c2/OneDrive - Universidad de los andes/Universidad/MECA/Big Data y Machine Learning/Repositorios/BD_ML_taller_1/Taller5-RegresionDiscontinua")
getwd()
# Definir carpeta de datos (ruta relativa)
path <- file.path(getwd(), "Datos/turquia.dta")
data <- read_dta(path)
path <- file.path(getwd("C:/Users/mc-c2/OneDrive - Universidad de los andes/Universidad/MECA/Big Data y Machine Learning/Repositorios/BD_ML_taller_1/Taller5-RegresionDiscontinua"), "Datos/turquia.dta")
data <- read_dta(path)
# Definir carpeta de datos (ruta relativa)
path <- file.path(setwd("C:/Users/mc-c2/OneDrive - Universidad de los andes/Universidad/MECA/Big Data y Machine Learning/Repositorios/BD_ML_taller_1/Taller5-RegresionDiscontinua"), "Datos/turquia.dta")
data <- read_dta(path)
setwd("C:/Users/mc-c2/OneDrive - Universidad de los andes/Universidad/MECA/Big Data y Machine Learning/Repositorios/BD_ML_taller_1/Taller5-RegresionDiscontinua")
getwd()
# Definir carpeta de datos (ruta relativa)
path <- file.path(getwd(), "Datos/turquia.dta")
data <- read_dta(path)
Comprendo perfectamente su frustración. Si ha descartado las barras invertidas y la función de lectura, el conflicto casi seguro se debe a una desconexión entre su Directorio de Trabajo de R (la ruta de getwd()) y la ubicación real del archivo cuando se usa una ruta relativa.
datos <- read_dta("turquia.dta")
datos <- read_dta("Datos/turquia.dta")
4
# Eliminar aletoriamente el 5% de las obs
n_eliminar <- round(0.05 * nrow(data))
filas_eliminar <- sample(1:nrow(data), n_eliminar)
turquia <- data[-filas_eliminar, ]
filas_eliminar <- sample(1:nrow(data), n_eliminar)
# Eliminar aletoriamente el 5% de las observaciones
n_eliminar <- round(0.05 * nrow(data))
filas_eliminar <- sample(1:nrow(data), n_eliminar)
data <- datos
rm(datos)
filas_eliminar <- sample(1:nrow(data), n_eliminar)
turquia <- data[-filas_eliminar, ]
# Eliminar aletoriamente el 5% de las observaciones
n_eliminar <- round(0.05 * nrow(data))
filas_eliminar <- sample(1:nrow(data), n_eliminar)
turquia <- data[-filas_eliminar, ]
