"Alcalde islámico (Dᵢ)"
),
notes = "Errores estándar agrupados por provincia.",
digits = 3,
label = "tab:rd_mujeres_hombres",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla1 <- tabla1[!grepl("^%", tabla1)]
print(tabla1)
# --- Guardar .tex limpio ---
writeLines(tabla1, "Tablas/tabla1.tex")
# Con controles y polinomio lineal
# Mujeres
modelo_f2 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia)
# Hombres
modelo_m2 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia)
# Errores clusterizados
se_f_2 <- sqrt(diag(vcovCL(modelo_f2, cluster = ~prov_num)))
se_m_2 <- sqrt(diag(vcovCL(modelo_m2, cluster = ~prov_num)))
# Tabla en Latex para Pdf
tabla2 <- capture.output(
stargazer(
modelo_f2, modelo_m2,
type = "latex",
se = list(se_f_2, se_m_2),
title = "Efecto de alcaldes islámicos sobre educación secundaria",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
dep.var.labels.include = FALSE,
covariate.labels = c(
"Alcalde islámico (Dᵢ)",
"Número de partidos (1994)",
"Población (log, 1994)",
"Proporción 0–19 años",
"Proporción 60+ años",
"Razón de sexo",
"Tamaño promedio del hogar",
"Categoría: Merkezi",
"Categoría: Merkezp",
"Categoría: Sub-Büyük",
"Categoría: Büyük"
),
notes = "Errores estándar agrupados por provincia. Todos los modelos incluyen efectos fijos por provincia.",
digits = 3,
label = "tab:rd_controles_mujeres_hombres",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla2 <- tabla2[!grepl("^%", tabla2)]
print(tabla2)
# --- Guardar .tex limpio ---
writeLines(tabla2, "Tablas/tabla2.tex")
# Mostrar tabla en consola (opcional)
cat(tabla2, sep = "\n")
# Filtrar submuestra
turquia_sub <- subset(turquia, xi >= -0.24 & xi <= 0.24)
# Mujeres
modelo_f3 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia_sub)
# Hombres
modelo_m3 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia_sub)
# Errores clusterizados
se_f3 <- sqrt(diag(vcovCL(modelo_f3, cluster = ~prov_num)))
se_m3 <- sqrt(diag(vcovCL(modelo_m3, cluster = ~prov_num)))
# Tabla en LaTeX
tabla3 <- capture.output(
stargazer(
modelo_f3, modelo_m3,
type = "latex",
se = list(se_f3, se_m3),
title = "Regresión Discontinua con controles (submuestra ĥ alrededor del corte)",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
dep.var.labels.include = FALSE,
covariate.labels = c(
"Alcalde islámico (Dᵢ)",
"Número de partidos (1994)",
"Población (log, 1994)",
"Proporción 0–19 años",
"Proporción 60+ años",
"Razón de sexo",
"Tamaño promedio del hogar",
"Categoría: Merkezi",
"Categoría: Merkezp",
"Categoría: Sub-Büyük",
"Categoría: Büyük"
),
notes = "Errores estándar agrupados por provincia. Submuestra: ±ĥ unidades alrededor del punto de corte. Incluye controles y efectos fijos por provincia.",
digits = 3,
label = "tab:rd_submuestra_h_mujeres_hombres",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla3 <- tabla3[!grepl("^%", tabla3)]
print(tabla3)
# --- Guardar .tex limpio ---
writeLines(tabla3, "Tablas/tabla3.tex")
# Mostrar tabla en consola (opcional)
cat(tabla3, sep = "\n")
# Filtrar la submuestra dentro del rango -0.12 a 0.12
turquia_sub_h2 <- subset(turquia, xi >= -0.12 & xi <= 0.12)
# Mujeres
modelo_f4 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia_sub_h2)
# Hombres
modelo_m4 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia_sub_h2)
# Errores clusterizados
se_f4 <- sqrt(diag(vcovCL(modelo_f4, cluster = ~prov_num)))
se_m4 <- sqrt(diag(vcovCL(modelo_m4, cluster = ~prov_num)))
# Tabla en LaTeX
tabla4 <- capture.output(
stargazer(
modelo_f4, modelo_m4,
type = "latex",
se = list(se_f4, se_m4),
title = "Regresión Discontinua con controles y ±ĥ/)",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
dep.var.labels.include = FALSE,
covariate.labels = c(
"Alcalde islámico (Dᵢ)",
"Número de partidos (1994)",
"Población (log, 1994)",
"Proporción 0–19 años",
"Proporción 60+ años",
"Razón de sexo",
"Tamaño promedio del hogar",
"Categoría: Merkezi",
"Categoría: Merkezp",
"Categoría: Sub-Büyük",
"Categoría: Büyük"
),
notes = "Errores estándar agrupados por provincia. Submuestra: ±ĥ/2 unidades alrededor del punto de corte. Incluye controles y efectos fijos por provincia.",
digits = 3,
label = "tab:rd_submuestra_h2_mujeres_hombres",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla4 <- tabla4[!grepl("^%", tabla4)]
print(tabla4)
# --- Guardar .tex limpio ---
writeLines(tabla4, "Tablas/tabla4.tex")
# Gráfico de densidad kernel de xi
grafico_kernel <- ggplot(turquia, aes(x = xi)) +
geom_density(fill = "lightblue", alpha = 0.5, color = "steelblue", linewidth = 1) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red", linewidth = 0.8) +
labs(
title = "Densidad kernel del margen electoral (xi)",
x = "Running Variable (xi)",
y = "Densidad"
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
panel.grid.minor = element_blank()
)
# Mostrar
print(grafico_kernel)
# Guardar
ggsave(
filename = "Tablas/grafico_kernel.png",
plot = grafico_kernel,
width = 7, height = 5, dpi = 300
)
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
knitr::opts_knit$set(root.dir = "C:/1. MECA/2025/EVALUACIACÓN DE IMPACTO- Raachid Raaj/Taller5-RegresionDiscontinua")
tinytex::tlmgr_update(self = TRUE, all = TRUE)
if (!requireNamespace("tinytex", quietly = TRUE)) {
install.packages("tinytex")
}
# Verificar si TinyTeX está instalado
if (tinytex::is_tinytex()) {
message("TinyTeX detectado. Actualizando instalación...")
# Actualizar gestor de paquetes (self) y todos los paquetes
tinytex::tlmgr_update(self = TRUE, all = TRUE)
message("TinyTeX actualizado correctamente.")
} else {
message("No se detecta TinyTeX. Si usas MikTeX o TeX Live, actualiza manualmente.")
}
# Cargar liberias y paquetes
# Instalando pacman si se requiere
if (!require("pacman")) install.packages("pacman")
# Cargando los paquetes usando pacman
pacman::p_load(
# A) Manipulación, limpieza y visualización de datos
tidyverse,    # Colección de paquetes esenciales (incluye dplyr, ggplot2, etc.)
dplyr,        # Manipulación de datos (ya incluido en tidyverse, pero lo dejamos explícito).
ggplot2,      # Visualización de datos (incluido en tidyverse).
scales,       # Manejo de escalas (ej. porcentajes, comas).
skimr,        # Resúmenes estadísticos rápidos de data.frames.
# B) Modelado y análisis estadístico/econométrico
fixest,       # Modelos de efectos fijos de alto rendimiento.
plm,          # Modelos para datos de panel.
AER,          # Herramientas de econometría aplicada.
lmtest,       # Pruebas de hipótesis para modelos de regresión.
sandwich,     # Errores estándar robustos.
survey,       # Análisis de encuestas complejas.
# C) Importación, exportación y generación de reportes
haven,        # Lectura/escritura de Stata, SAS, SPSS.
stargazer,    # Tablas de regresión con formato publicable.
knitr,        # Reportes dinámicos en RMarkdown.
modelsummary, # Tablas y resúmenes comparativos de modelos.
tinytex       # Soporte para compilar a PDF con LaTeX en RMarkdown.
)
# Definir carpeta de datos (ruta relativa)
path <- file.path(getwd(), "Datos/turquia.dta")
data <- read_dta(path)
# Fijar semilla con el cod de Laura
set.seed(202421904)
# Eliminar aletoriamente el 5% de las observaciones
n_eliminar <- round(0.05 * nrow(data))
filas_eliminar <- sample(1:nrow(data), n_eliminar)
turquia <- data[-filas_eliminar, ]
# Tratamiento de si se eligió un alcalde islámico
turquia <- turquia %>%
rename(xi = ilmvsm1994) %>%
mutate(
di = ifelse(xi >= 0, 1, 0),    # tratamiento: alcalde islámico
hischshr1520m = hischshr1520m / 100,
hischshr1520f = hischshr1520f / 100
)
# Primer modelo sin controles para ambos sexos
modelo_f <- lm(hischshr1520f ~ di*xi, data = turquia)  # mujeres
modelo_m <- lm(hischshr1520m ~ di*xi, data = turquia)  # hombres
# Errores estándar agrupados por provincia
se_f <- sqrt(diag(vcovCL(modelo_f, cluster = ~ prov_num)))
se_m <- sqrt(diag(vcovCL(modelo_m, cluster = ~ prov_num)))
# Tabla en Latex para Pdf
tabla1 <- capture.output(
stargazer(
modelo_f, modelo_m,
type = "latex",
se = list(se_f, se_m),
title = "Efecto de alcaldes islámicos sobre educación secundaria",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
dep.var.labels.include = FALSE,
covariate.labels = c(
"Alcalde islámico (Dᵢ)"
),
notes = "Errores estándar agrupados por provincia.",
digits = 3,
label = "tab:rd_mujeres_hombres",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla1 <- tabla1[!grepl("^%", tabla1)]
print(tabla1)
# --- Guardar .tex limpio ---
writeLines(tabla1, "Tablas/tabla1.tex")
# Con controles y polinomio lineal
# Mujeres
modelo_f2 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia)
# Hombres
modelo_m2 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia)
# Errores clusterizados
se_f_2 <- sqrt(diag(vcovCL(modelo_f2, cluster = ~prov_num)))
se_m_2 <- sqrt(diag(vcovCL(modelo_m2, cluster = ~prov_num)))
# Tabla en Latex para Pdf
tabla2 <- capture.output(
stargazer(
modelo_f2, modelo_m2,
type = "latex",
se = list(se_f_2, se_m_2),
title = "Efecto de alcaldes islámicos sobre educación secundaria",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
dep.var.labels.include = FALSE,
covariate.labels = c(
"Alcalde islámico (Dᵢ)",
"Número de partidos (1994)",
"Población (log, 1994)",
"Proporción 0–19 años",
"Proporción 60+ años",
"Razón de sexo",
"Tamaño promedio del hogar",
"Categoría: Merkezi",
"Categoría: Merkezp",
"Categoría: Sub-Büyük",
"Categoría: Büyük"
),
notes = "Errores estándar agrupados por provincia. Todos los modelos incluyen efectos fijos por provincia.",
digits = 3,
label = "tab:rd_controles_mujeres_hombres",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla2 <- tabla2[!grepl("^%", tabla2)]
print(tabla2)
# --- Guardar .tex limpio ---
writeLines(tabla2, "Tablas/tabla2.tex")
# Mostrar tabla en consola (opcional)
cat(tabla2, sep = "\n")
# Filtrar submuestra
turquia_sub <- subset(turquia, xi >= -0.24 & xi <= 0.24)
# Mujeres
modelo_f3 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia_sub)
# Hombres
modelo_m3 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia_sub)
# Errores clusterizados
se_f3 <- sqrt(diag(vcovCL(modelo_f3, cluster = ~prov_num)))
se_m3 <- sqrt(diag(vcovCL(modelo_m3, cluster = ~prov_num)))
# Tabla en LaTeX
tabla3 <- capture.output(
stargazer(
modelo_f3, modelo_m3,
type = "latex",
se = list(se_f3, se_m3),
title = "Regresión Discontinua con controles (submuestra ĥ alrededor del corte)",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
dep.var.labels.include = FALSE,
covariate.labels = c(
"Alcalde islámico (Dᵢ)",
"Número de partidos (1994)",
"Población (log, 1994)",
"Proporción 0–19 años",
"Proporción 60+ años",
"Razón de sexo",
"Tamaño promedio del hogar",
"Categoría: Merkezi",
"Categoría: Merkezp",
"Categoría: Sub-Büyük",
"Categoría: Büyük"
),
notes = "Errores estándar agrupados por provincia. Submuestra: ±ĥ unidades alrededor del punto de corte. Incluye controles y efectos fijos por provincia.",
digits = 3,
label = "tab:rd_submuestra_h_mujeres_hombres",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla3 <- tabla3[!grepl("^%", tabla3)]
print(tabla3)
# --- Guardar .tex limpio ---
writeLines(tabla3, "Tablas/tabla3.tex")
# Mostrar tabla en consola (opcional)
cat(tabla3, sep = "\n")
# Filtrar la submuestra dentro del rango -0.12 a 0.12
turquia_sub_h2 <- subset(turquia, xi >= -0.12 & xi <= 0.12)
# Mujeres
modelo_f4 <- lm(hischshr1520f ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia_sub_h2)
# Hombres
modelo_m4 <- lm(hischshr1520m ~ di + xi + I(xi*di) +
partycount + lpop1994 +
ageshr19 + ageshr60 + sexr + shhs +
merkezi + merkezp + subbuyuk + buyuk,
data = turquia_sub_h2)
# Errores clusterizados
se_f4 <- sqrt(diag(vcovCL(modelo_f4, cluster = ~prov_num)))
se_m4 <- sqrt(diag(vcovCL(modelo_m4, cluster = ~prov_num)))
# Tabla en LaTeX
tabla4 <- capture.output(
stargazer(
modelo_f4, modelo_m4,
type = "latex",
se = list(se_f4, se_m4),
title = "Regresión Discontinua con controles y ±ĥ/)",
column.labels = c("Mujeres", "Hombres"),
dep.var.labels = "Proporción con secundaria completa (15–20 años)",
dep.var.labels.include = FALSE,
covariate.labels = c(
"Alcalde islámico (Dᵢ)",
"Número de partidos (1994)",
"Población (log, 1994)",
"Proporción 0–19 años",
"Proporción 60+ años",
"Razón de sexo",
"Tamaño promedio del hogar",
"Categoría: Merkezi",
"Categoría: Merkezp",
"Categoría: Sub-Büyük",
"Categoría: Büyük"
),
notes = "Errores estándar agrupados por provincia. Submuestra: ±ĥ/2 unidades alrededor del punto de corte. Incluye controles y efectos fijos por provincia.",
digits = 3,
label = "tab:rd_submuestra_h2_mujeres_hombres",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla4 <- tabla4[!grepl("^%", tabla4)]
print(tabla4)
# --- Guardar .tex limpio ---
writeLines(tabla4, "Tablas/tabla4.tex")
# Gráfico de densidad kernel de xi
grafico_kernel <- ggplot(turquia, aes(x = xi)) +
geom_density(fill = "lightblue", alpha = 0.5, color = "steelblue", linewidth = 1) +
geom_vline(xintercept = 0, linetype = "dashed", color = "red", linewidth = 0.8) +
labs(
title = "Densidad kernel del margen electoral (xi)",
x = "Running Variable (xi)",
y = "Densidad"
) +
theme_minimal(base_size = 13) +
theme(
plot.title = element_text(hjust = 0.5, face = "bold"),
panel.grid.minor = element_blank()
)
# Mostrar
print(grafico_kernel)
# Guardar
ggsave(
filename = "Tablas/grafico_kernel.png",
plot = grafico_kernel,
width = 7, height = 5, dpi = 300
)
# Alcalde islámico en 1984
modelo_i89 <- lm(i89 ~ di + xi + I(xi*di), data = turquia_sub)
# Log población en 1994
modelo_lpop <- lm(lpop1994 ~ di + xi + I(xi*di), data = turquia_sub)
# Errores clusterizados
se_i89 <- sqrt(diag(vcovCL(modelo_i89, cluster = ~prov_num)))
se_lpop <- sqrt(diag(vcovCL(modelo_lpop, cluster = ~prov_num)))
# Tabla
tabla5 <- capture.output(
stargazer(modelo_i89, modelo_lpop,
se = list(se_i89, se_lpop),
type = "latex",
dep.var.labels = c("Alcalde islámico en 1984", "Log población 1994"),
covariate.labels = c("Ganó alcalde islámico", "Margen electoral", "Interacción margen x ganador"),
title = "Prueba de continuidad en variables específicas",
label = "tab:continuidad_predeterminadas",
header = FALSE,
table.placement = "ht!",
escape = TRUE,
single.row = TRUE
)
)
# Quitar comentarios de stargazer (para un .tex limpio)
tabla5 <- tabla5[!grepl("^%", tabla5)]
# --- Guardar .tex limpio ---
writeLines(tabla5, "Tablas/tabla5.tex")
# Mostrar tabla en consola
cat(tabla5, sep = "\n")
